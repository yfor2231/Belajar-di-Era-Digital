<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Mockup Progres Pekerjaan</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
    body {font-family: Arial, sans-serif; background:#f4f6f9; padding:20px;}
    .card {background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.1);}
    table {width:100%; border-collapse:collapse; margin-top:15px; font-size:13px;}
    th, td {border:1px solid #ddd; padding:6px 8px; text-align:center;}
    th {background:#0d6efd; color:white;}

    .progress-box {display:flex; align-items:center; gap:6px; justify-content:center;}
    .bar {width:90px; height:10px; background:#eee; border-radius:5px; overflow:hidden;}
    .fill {height:100%;}

    .red {background:#dc3545;}
    .yellow {background:#ffc107;}
    .green {background:#198754;}

    .status {
        padding:4px 10px;
        border-radius:6px;
        font-weight:bold;
        font-size:12px;
        display:inline-block;
    }
    .onprogres {background:#ffc107; color:#000;}
    .selesai {background:#198754; color:white;}
    .invalid {background:#dc3545; color:white;}
    .nobanper {background:#198754; color:white;}

    .belum {color:#dc3545; font-weight:bold;}
</style>
</head>
<body>

<h2>Mockup UI – Progres Pekerjaan</h2>

<div class="card">
    <b>Impor Data Excel:</b><br>
    <input type="file" id="excelFile" accept=".xlsx,.xls">

    <table id="tabel">
        <thead>
            <tr>
                <th>No</th>
                <th>Nama Sekolah</th>
                <th>RBA Awal</th>
                <th>RBA Perubahan</th>
                <th>RBA Banper</th>
                <th>Rekon</th>
                <th>Input Realisasi</th>
                <th>Saldo Awal</th>
                <th>Keterangan</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
document.getElementById("excelFile").addEventListener("change", handleFile, false);

function handleFile(e) {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = function(evt) {
        const data = new Uint8Array(evt.target.result);
        const workbook = XLSX.read(data, {type: 'array'});
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(sheet, {defval: ""});
        renderTable(json);
    };
    reader.readAsArrayBuffer(file);
}

function percent(belanja, pendapatan) {
    if (!pendapatan || pendapatan == 0) return 0;
    return Math.round((belanja / pendapatan) * 100);
}

function statusColor(persen){
    if(persen == 100) return "green";
    if(persen >= 70) return "yellow";
    return "red";
}

function progressHTML(persen) {
    let color = statusColor(persen);
    return `
        <div class="progress-box">
            <div class="bar">
                <div class="fill ${color}" style="width:${persen}%"></div>
            </div>
            <span><b>${persen}%</b> ${persen===100?"✔":""}</span>
        </div>
    `;
}

function statusRealisasiHTML(val){
    let v = String(val).toLowerCase().trim();
    if(v === "selesai") return `<span class="status selesai">Selesai</span>`;
    if(v === "on progres" || v === "on progress") return `<span class="status onprogres">On Progres</span>`;
    return `<span class="status invalid">Tidak valid</span>`;
}

function banperHTML(persen, pendapatan, belanja){
    if(Number(pendapatan) === 0 && Number(belanja) === 0 && persen === 0){
        return `<span class="status nobanper">Tidak Ada Banper</span>`;
    }
    return progressHTML(persen);
}

function renderTable(data) {
    const tbody = document.querySelector("#tabel tbody");
    tbody.innerHTML = "";

    data.forEach((row, i) => {
        let rbaAwal = percent(row.RBA_Awal_Belanja, row.RBA_Awal_Pendapatan);
        let rbaUbah = percent(row.RBA_Perubahan_Belanja, row.RBA_Perubahan_Pendapatan);
        let rbaBan = percent(row.RBA_Banper_Belanja, row.RBA_Banper_Pendapatan);
        let rekon = Math.round((row.Bulan_Rekon / 12) * 100);

        let realisasi = statusRealisasiHTML(row.Realisasi);

        let saldo = isNaN(row["Saldo Awal"]) || row["Saldo Awal"] === ""
            ? `<span class="belum">Belum Update</span>`
            : Number(row["Saldo Awal"]).toLocaleString("id-ID");

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${row.No || i+1}</td>
            <td style="text-align:left">${row["Nama Sekolah"] || ""}</td>
            <td>${progressHTML(rbaAwal)}</td>
            <td>${progressHTML(rbaUbah)}</td>
            <td>${banperHTML(rbaBan, row.RBA_Banper_Pendapatan, row.RBA_Banper_Belanja)}</td>
            <td>${progressHTML(rekon)}</td>
            <td>${realisasi}</td>
            <td>${saldo}</td>
            <td style="text-align:left">${row.Keterangan || ""}</td>
        `;
        tbody.appendChild(tr);
    });
}
</script>

</body>
</html>
